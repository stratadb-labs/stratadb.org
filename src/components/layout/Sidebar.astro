---
interface SidebarItem {
  title: string;
  href: string;
  items?: SidebarItem[];
}

interface Props {
  items: SidebarItem[];
  currentPath: string;
}

const { items, currentPath } = Astro.props;

function isActive(href: string): boolean {
  return currentPath === href || currentPath.startsWith(href + '/');
}

function hasActiveChild(item: SidebarItem): boolean {
  if (isActive(item.href)) return true;
  if (item.items) {
    return item.items.some(child => hasActiveChild(child));
  }
  return false;
}
---

<nav class="w-64 flex-shrink-0 hidden lg:block">
  <div class="sticky top-24 pr-4 overflow-y-auto max-h-[calc(100vh-8rem)] scrollbar-thin">
    <ul class="space-y-1">
      {items.map((item) => (
        <li>
          {item.items ? (
            <details open={hasActiveChild(item)} class="group">
              <summary class="flex items-center justify-between px-3 py-2 text-sm font-medium text-text-secondary hover:text-text-primary cursor-pointer list-none">
                {item.title}
                <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </summary>
              <ul class="mt-1 ml-4 space-y-1 border-l border-border">
                {item.items.map((subitem) => (
                  <li>
                    <a
                      href={subitem.href}
                      class:list={[
                        'block px-3 py-1.5 text-sm transition-colors -ml-px border-l-2',
                        isActive(subitem.href)
                          ? 'border-terracotta text-terracotta font-medium'
                          : 'border-transparent text-text-secondary hover:text-text-primary hover:border-border'
                      ]}
                    >
                      {subitem.title}
                    </a>
                  </li>
                ))}
              </ul>
            </details>
          ) : (
            <a
              href={item.href}
              class:list={[
                'block px-3 py-2 text-sm rounded-lg transition-colors',
                isActive(item.href)
                  ? 'bg-terracotta/10 text-terracotta font-medium'
                  : 'text-text-secondary hover:text-text-primary hover:bg-background-muted'
              ]}
            >
              {item.title}
            </a>
          )}
        </li>
      ))}
    </ul>
  </div>
</nav>
